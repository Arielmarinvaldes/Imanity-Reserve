# Web Reservation API Guide

To integrate an external website with RestoZen, the website needs to create new reservation documents directly in your Firestore database.

## 1. Firestore Configuration

The external website's backend must be configured with your Firebase project credentials to securely write to the database. This is typically done using a "service account".

- Go to your Firebase project settings.
- Navigate to the "Service accounts" tab.
- Click "Generate new private key" to download a JSON file with your credentials. **Keep this file secure on your server!**

## 2. Data Model

When a customer makes a reservation on the website, a new document should be created in the `reservations` collection.

**Collection:** `reservations`

**Document ID:** Auto-generated by Firestore.

### Document Fields:

| Field            | Type                          | Required | Description                                                                                                                              | Example Value                        |
| ---------------- | ----------------------------- | -------- | ---------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------ |
| `guestName`      | `string`                      | Yes      | The name of the guest making the reservation.                                                                                            | `"Jane Smith"`                         |
| `partySize`      | `number`                      | Yes      | The number of people in the party.                                                                                                       | `4`                                  |
| `dateTime`       | `firestore.Timestamp`         | Yes      | The date and time of the reservation. **Must be a Firestore Timestamp object.**                                                          | `Timestamp.fromDate(new Date())`     |
| `guestPhone`     | `string`                      | No       | The guest's phone number.                                                                                                                | `"+15551234567"`                     |
| `needsHighChair` | `boolean`                     | No       | Set to `true` if the party requires a high chair. Defaults to `false` if not provided.                                                   | `true`                               |
| `status`         | `string`                      | Yes      | Must be hardcoded to `"Upcoming"`.                                                                                                       | `"Upcoming"`                         |
| `tableId`        | `string`                      | Yes      | Must be an empty string `""`. The RestoZen system will automatically assign a table.                                                       | `""`                                 |

## 3. Example Implementation (Node.js)

Here's a basic example of how your website's backend (using Node.js and the Firebase Admin SDK) would create a reservation.

First, install the SDK: `npm install firebase-admin`

Then, use this code:

```javascript
// Import necessary Firebase Admin modules
const { initializeApp, cert } = require('firebase-admin/app');
const { getFirestore, Timestamp } = require('firebase-admin/firestore');

// Load your service account credentials
const serviceAccount = require('./path/to/your/serviceAccountKey.json');

// Initialize the Firebase app
initializeApp({
  credential: cert(serviceAccount)
});

// Get a reference to the Firestore database
const db = getFirestore();

// --- Function to create a new reservation ---
async function createWebReservation(reservationData) {
  try {
    // Data from the website's booking form
    const { guestName, partySize, reservationDateTime, guestPhone, needsHighChair } = reservationData;

    const newReservation = {
      guestName: guestName, // e.g., "Jane Smith"
      partySize: parseInt(partySize, 10), // e.g., 4
      dateTime: Timestamp.fromDate(new Date(reservationDateTime)), // e.g., new Date("2024-08-15T19:30:00")
      guestPhone: guestPhone || "", // Optional
      needsHighChair: needsHighChair || false, // Optional
      status: "Upcoming", // Must be "Upcoming"
      tableId: "" // Must be an empty string
    };

    const docRef = await db.collection('reservations').add(newReservation);
    console.log('Reservation created with ID: ', docRef.id);
    return { success: true, reservationId: docRef.id };

  } catch (error) {
    console.error("Error creating reservation: ", error);
    return { success: false, error: error.message };
  }
}

// --- Example Usage ---
/*
createWebReservation({
  guestName: "Web User",
  partySize: 3,
  reservationDateTime: "2024-09-20T20:00:00", // Use ISO 8601 format
  needsHighChair: true
});
*/
```

## 4. Automatic Table Assignment

When a new reservation document is created with an empty `tableId`, the RestoZen system will automatically perform the following actions:

1.  It detects the new, unassigned reservation.
2.  It checks for available tables on the specified `dateTime` that can accommodate the `partySize`.
3.  It prioritizes the smallest available table that fits the party (best fit).
4.  If a suitable table is found, the system updates the reservation document, filling in the `tableId` with the ID of the assigned table.
5.  If no suitable table is found (e.g., the restaurant is fully booked for that party size at that time), the `tableId` will remain empty. The restaurant staff will see this unassigned reservation in their dashboard and must handle it manually.
